<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DONOSWAVE</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
</head>
<body>

<!-- ========== HEADER ========== -->
<header class="cabecera">
    <div class="logo">
        <a href="{{ url_for('catalog.home') }}">
            <img src="{{ url_for('static', filename='imagenes/logo_naranja.png') }}" alt="Logo">
        </a>
    </div>
    <nav>
        <a href="{{ url_for('catalog.home') }}">Inicio</a>
        <a href="#productos">Eventos</a>
        <a href="{{ url_for('catalog.contacto') }}">Contacto</a>
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('catalog.logout') }}" class="login-btn">Cerrar sesi√≥n</a>
        {% else %}
            <a href="{{ url_for('catalog.login') }}" class="login-btn">Iniciar sesi√≥n</a>
            <a href="{{ url_for('catalog.register') }}" class="login-btn">Registrarse</a>
        {% endif %}
    </nav>
</header>

<!-- ========== HERO ========== -->
<section class="hero" id="inicio">
    <div class="hero-texto">
        <h1>Vive los mejores eventos en Donostia</h1>
        <p>Entradas oficiales para conciertos, festivales y experiencias √∫nicas</p>
        <a href="#productos" class="btn-principal">Ver eventos</a>
    </div>
</section>

<!-- ========== PRODUCTOS ========== -->
<section class="productos" id="productos">
    <h2>Eventos destacados</h2>

    <!-- FILTROS -->
    <div class="filtros">
        <button class="filtro activo" data-categoria="todos">Todos</button>
        <button class="filtro" data-categoria="musica">M√∫sica</button>
        <button class="filtro" data-categoria="gastronomia">Gastronom√≠a</button>
        <button class="filtro" data-categoria="cine">Cine</button>
        <button class="filtro" data-categoria="otros">Otros</button>
    </div>

    <!-- GRID DE PRODUCTOS -->
    <div class="grid-productos">

        <!-- PRODUCTO 1 -->
        <div class="producto-card" data-categoria="musica">
            <img src="{{ url_for('static', filename='imagenes/Jazzaldia.jpg') }}">
            <div class="producto-info">
                <h3>Jazzaldia</h3>
                <p>Conciertos al aire libre en la Zurriola</p>
                <div class="producto-footer">
                    <span class="precio">30‚Ç¨</span>
                    {% if current_user.is_authenticated %}
                        <form action="{{ url_for('catalog.comprar', id_producto=1) }}" method="POST">
                            <input type="hidden" name="cantidad" value="1">
                            <button type="submit" class="btn-secundario">Comprar</button>
                        </form>
                    {% else %}
                        <a href="{{ url_for('catalog.login') }}" class="btn-secundario">Inicia sesi√≥n para comprar</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- PRODUCTO 2 -->
        <div class="producto-card" data-categoria="gastronomia">
            <img src="{{ url_for('static', filename='imagenes/gastronomia.jpg') }}">
            <div class="producto-info">
                <h3>Festival Gastron√≥mico</h3>
                <p>Los mejores chefs del pa√≠s</p>
                <div class="producto-footer">
                    <span class="precio">60‚Ç¨</span>
                    {% if current_user.is_authenticated %}
                        <form action="{{ url_for('catalog.comprar', id_producto=2) }}" method="POST">
                            <input type="hidden" name="cantidad" value="1">
                            <button type="submit" class="btn-secundario">Comprar</button>
                        </form>
                    {% else %}
                        <a href="{{ url_for('catalog.login') }}" class="btn-secundario">Inicia sesi√≥n para comprar</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- PRODUCTO 3 -->
        <div class="producto-card" data-categoria="cine">
            <img src="{{ url_for('static', filename='imagenes/cine.jpg') }}">
            <div class="producto-info">
                <h3>Zinemaldia</h3>
                <p>Estrenos y premios internacionales</p>
                <div class="producto-footer">
                    <span class="precio">67‚Ç¨</span>
                    {% if current_user.is_authenticated %}
                        <form action="{{ url_for('catalog.comprar', id_producto=3) }}" method="POST">
                            <input type="hidden" name="cantidad" value="1">
                            <button type="submit" class="btn-secundario">Comprar</button>
                        </form>
                    {% else %}
                        <a href="{{ url_for('catalog.login') }}" class="btn-secundario">Inicia sesi√≥n para comprar</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- PRODUCTO 4 -->
        <div class="producto-card" data-categoria="otros">
            <img src="{{ url_for('static', filename='imagenes/Tamborrada.webp') }}">
            <div class="producto-info">
                <h3>San Sebasti√°n Eguna</h3>
                <p>Celebraci√≥n del D√≠a de San Sebasti√°n</p>
                <div class="producto-footer">
                    <span class="precio">30‚Ç¨</span>
                    {% if current_user.is_authenticated %}
                        <form action="{{ url_for('catalog.comprar', id_producto=4) }}" method="POST">
                            <input type="hidden" name="cantidad" value="1">
                            <button type="submit" class="btn-secundario">Comprar</button>
                        </form>
                    {% else %}
                        <a href="{{ url_for('catalog.login') }}" class="btn-secundario">Inicia sesi√≥n para comprar</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- PRODUCTO 5 -->
        <div class="producto-card" data-categoria="musica">
            <img src="{{ url_for('static', filename='imagenes/musica.webp') }}">
            <div class="producto-info">
                <h3>Semana Musical Donostiarra</h3>
                <p>Festival de m√∫sica cl√°sica y contempor√°nea</p>
                <div class="producto-footer">
                    <span class="precio">45‚Ç¨</span>
                    {% if current_user.is_authenticated %}
                        <form action="{{ url_for('catalog.comprar', id_producto=5) }}" method="POST">
                            <input type="hidden" name="cantidad" value="1">
                            <button type="submit" class="btn-secundario">Comprar</button>
                        </form>
                    {% else %}
                        <a href="{{ url_for('catalog.login') }}" class="btn-secundario">Inicia sesi√≥n para comprar</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- PRODUCTO 6 -->
        <div class="producto-card" data-categoria="otros">
            <img src="{{ url_for('static', filename='imagenes/remo.jpg') }}">
            <div class="producto-info">
                <h3>Regata de La Concha</h3>
                <p>Competici√≥n de veleros en la bah√≠a de La Concha</p>
                <div class="producto-footer">
                    <span class="precio">35‚Ç¨</span>
                    {% if current_user.is_authenticated %}
                        <form action="{{ url_for('catalog.comprar', id_producto=6) }}" method="POST">
                            <input type="hidden" name="cantidad" value="1">
                            <button type="submit" class="btn-secundario">Comprar</button>
                        </form>
                    {% else %}
                        <a href="{{ url_for('catalog.login') }}" class="btn-secundario">Inicia sesi√≥n para comprar</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- PRODUCTO 7 -->
        <div class="producto-card" data-categoria="otros">
            <img src="{{ url_for('static', filename='imagenes/Real.webp') }}">
            <div class="producto-info">
                <h3>Real Sociedad vs Real Oviedo</h3>
                <p>Partido de f√∫tbol entre Real Sociedad y Real Oviedo.</p>
                <div class="producto-footer">
                    <span class="precio">40‚Ç¨</span>
                    {% if current_user.is_authenticated %}
                        <form action="{{ url_for('catalog.comprar', id_producto=7) }}" method="POST">
                            <input type="hidden" name="cantidad" value="1">
                            <button type="submit" class="btn-secundario">Comprar</button>
                        </form>
                    {% else %}
                        <a href="{{ url_for('catalog.login') }}" class="btn-secundario">Inicia sesi√≥n para comprar</a>
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- PRODUCTO 8 -->
        <div class="producto-card" data-categoria="musica">
            <img src="{{ url_for('static', filename='imagenes/julio.webp') }}">
            <div class="producto-info">
                <h3>Julio Iglesias Experience</h3>
                <p>Concierto tributo a Julio Iglesias.</p>
                <div class="producto-footer">
                    <span class="precio">200‚Ç¨</span>
                    {% if current_user.is_authenticated %}
                        <form action="{{ url_for('catalog.comprar', id_producto=8) }}" method="POST">
                            <input type="hidden" name="cantidad" value="1">
                            <button type="submit" class="btn-secundario">Comprar</button>
                        </form>
                    {% else %}
                        <a href="{{ url_for('catalog.login') }}" class="btn-secundario">Inicia sesi√≥n para comprar</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- PRODUCTO 9 -->
        <div class="producto-card" data-categoria="otros">
            <img src="{{ url_for('static', filename='imagenes/ballet.webp') }}">
            <div class="producto-info">
                <h3>‚ÄúEl Cascanueces‚Äù  Ballet Cl√°sico</h3>
                <p>Versi√≥n de pago del famoso ballet navide√±o ‚ÄúEl Cascanueces‚Äù, con orquesta en vivo y coreograf√≠a cl√°sica.</p>
                <div class="producto-footer">
                    <span class="precio">60‚Ç¨</span>
                    {% if current_user.is_authenticated %}
                        <form action="{{ url_for('catalog.comprar', id_producto=9) }}" method="POST">
                            <input type="hidden" name="cantidad" value="1">
                            <button type="submit" class="btn-secundario">Comprar</button>
                        </form>
                    {% else %}
                        <a href="{{ url_for('catalog.login') }}" class="btn-secundario">Inicia sesi√≥n para comprar</a>
                    {% endif %}
                </div>
            </div>
        </div>

    </div>

    <!-- PAGINACION -->
    <div class="paginacion" id="paginacion-vue">
      <button @click="anterior" :disabled="paginaActual === 1"> Anterior</button>
      <span>P√°gina {{ paginaActual }} de {{ totalPaginas }}</span>
      <button @click="siguiente" :disabled="paginaActual === totalPaginas">Siguiente</button>
    </div>
</section>

<!-- ========== FOOTER ========== -->
<footer>
    <div class="footer-content">
        <div class="footer-section">
            <h3>DONOSWAVE</h3>
            <p>Tu plataforma de eventos en Donostia</p>
        </div>
        <div class="footer-section">
            <h3>Contacto</h3>
            <p>. Email: info@donoswave.com</p>
            <p>. Tel: +34 943 123 456</p>
            <p>¬∑ Localidad: Donostia-San Sebasti√°n, Espa√±a</p>
        </div>
        <div class="footer-section">
            <h3>Ubicaci√≥n</h3>
            <button id="mostrarMapa">Ver mapa</button>
            <div id="map" style="display:none;"></div>
        </div>
    </div>
    <div class="footer-bottom">
        <p>&copy; 2025 DONOSWAVE</p>
    </div>
</footer>

<!-- ================== SCRIPTS ================== -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/mapa.js') }}"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

<!-- ================== MINI-CHAT ================== -->
<div id="mini-chat">
    <button id="chat-toggle" aria-label="Abrir chat">üí¨</button>
    <div id="chat-window" aria-hidden="true">
        <div id="chat-header">
            <strong>Asistente Ollama</strong>
            <button id="chat-close" aria-label="Cerrar chat">‚úï</button>
        </div>
        <div id="chat-messages" role="log" aria-live="polite"></div>
        <form id="chat-form">
            <div class="chat-input-wrap">
                <input id="chat-input" type="text" placeholder="Escribe tu pregunta..." autocomplete="off" required />
                <button id="chat-mic" type="button" title="Hablar" aria-label="Activar reconocimiento de voz">üé§</button>
            </div>
            <button type="submit">Enviar</button>
        </form>
    </div>
</div>

<script src="{{ url_for('static', filename='js/chat.js') }}"></script>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            productos: Array.from(document.querySelectorAll('.producto-card')),
            paginaActual: 1,
            porPagina: 3,
            filtroActual: 'todos'
        }
    },
    computed: {
        productosFiltrados() {
            if (this.filtroActual === 'todos') return this.productos;
            return this.productos.filter(p => p.dataset.categoria === this.filtroActual);
        },
        totalPaginas() {
            return Math.ceil(this.productosFiltrados.length / this.porPagina) || 1;
        }
    },
    methods: {
        mostrarProductos() {
            const inicio = (this.paginaActual - 1) * this.porPagina;
            const fin = inicio + this.porPagina;
            this.productos.forEach(p => p.style.display = "none");
            this.productosFiltrados.slice(inicio, fin).forEach(p => p.style.display = "flex");
        },
        siguiente() {
            if(this.paginaActual < this.totalPaginas) {
                this.paginaActual++;
                this.mostrarProductos();
            }
        },
        anterior() {
            if(this.paginaActual > 1) {
                this.paginaActual--;
                this.mostrarProductos();
            }
        },
        cambiarFiltro(cat) {
            this.filtroActual = cat;
            this.paginaActual = 1;

            document.querySelectorAll('.filtros .filtro').forEach(btn => {
                btn.classList.toggle('activo', btn.dataset.categoria === cat);
            });

            this.mostrarProductos();
        }
    },
    mounted() {
        document.querySelectorAll('.filtros .filtro').forEach(btn => {
            btn.addEventListener('click', () => this.cambiarFiltro(btn.dataset.categoria));
        });

        this.mostrarProductos();
    },
    watch: {
        productosFiltrados() {
            this.paginaActual = 1;
            this.mostrarProductos();
        }
    }
}).mount('#paginacion-vue');
</script>

</body>
</html>
